==========================================
AWS Infrastructure Creation Script
==========================================
AWS Profile: flyon21
Region: eu-central-1
Availability Zone: eu-central-1a
==========================================
[1/15] Creating VPC...
VPC ID: vpc-0566d293bb71b1cec
[2/15] Creating Public Subnet...
Public Subnet ID: subnet-0d9872addfb2de55d
[3/15] Creating Private Subnet...
Private Subnet ID: subnet-0ae8cc16328ac6687
[4/15] Creating Internet Gateway...
Internet Gateway ID: igw-0d86c35657eeff79e
[5/15] Attaching Internet Gateway to VPC...
[6/15] Allocating Elastic IP for NAT Gateway...
NAT Gateway EIP Allocation ID: eipalloc-0fcdc8afa37250510
[7/15] Creating NAT Gateway...
NAT Gateway ID: nat-0a2dc38ddb5ddd1fe
Waiting for NAT Gateway to be available...
[8/15] Creating Public Route Table...
Public Route Table ID: rtb-07a4a4de1f740d030
[9/15] Adding route to Internet Gateway...
{
    "Return": true
}
[10/15] Associating Public Subnet with Public Route Table...
{
    "AssociationId": "rtbassoc-0ebefb048e886b5eb",
    "AssociationState": {
        "State": "associated"
    }
}
[11/15] Creating Private Route Table...
Private Route Table ID: rtb-0010dc33fd8cf8f56
[12/15] Adding route to NAT Gateway...
{
    "Return": true
}
[13/15] Associating Private Subnet with Private Route Table...
{
    "AssociationId": "rtbassoc-09cc0f3244ffa08b3",
    "AssociationState": {
        "State": "associated"
    }
}
[14/15] Creating SSH Key Pair...
Using provided SSH PUBLIC key from: /home/flyon21/.ssh/zhoholiev.pub
{
    "KeyFingerprint": "49:16:01:e5:a9:e3:fd:d6:c0:09:08:47:b9:be:e0:9f",
    "KeyName": "Flyon21-KeyPair",
    "KeyPairId": "key-0cd129466e43ee876",
    "Tags": [
        {
            "Key": "Name",
            "Value": "Flyon21-KeyPair"
        }
    ]
}
âœ“ SSH public key imported successfully
Note: Use your existing private key (corresponding to this public key) to connect to instances
[15/15] Creating Security Groups...
Public Security Group ID: sg-01792dd14dfccfde9
Adding SSH ingress rule for IP: 94.131.197.224
{
    "Return": true,
    "SecurityGroupRules": [
        {
            "SecurityGroupRuleId": "sgr-0df843fa1a343405a",
            "GroupId": "sg-01792dd14dfccfde9",
            "GroupOwnerId": "<YOUR_ACCAUNT_IDENTIFIER>",
            "IsEgress": false,
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "CidrIpv4": "94.131.197.224/32",
            "SecurityGroupRuleArn": "arn:aws:ec2:eu-central-1:<YOUR_ACCAUNT_IDENTIFIER>:security-group-rule/sgr-0df843fa1a343405a"
        }
    ]
}
Private Security Group ID: sg-022b9c6678600264c
{
    "Return": true,
    "SecurityGroupRules": [
        {
            "SecurityGroupRuleId": "sgr-0ff43c21a8e9dd094",
            "GroupId": "sg-022b9c6678600264c",
            "GroupOwnerId": "<YOUR_ACCAUNT_IDENTIFIER>",
            "IsEgress": false,
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "ReferencedGroupInfo": {
                "GroupId": "sg-01792dd14dfccfde9",
                "UserId": "<YOUR_ACCAUNT_IDENTIFIER>"
            },
            "SecurityGroupRuleArn": "arn:aws:ec2:eu-central-1:<YOUR_ACCAUNT_IDENTIFIER>:security-group-rule/sgr-0ff43c21a8e9dd094"
        }
    ]
}
Getting latest Amazon Linux 2 AMI...
AMI ID: ami-06a147740881f882e
Creating Public EC2 Instance...
Public Instance ID: i-00110b7dc75a13790
Waiting for public instance to be running...
Allocating Elastic IP for Public Instance...
Public Instance EIP Allocation ID: eipalloc-05ed41c5757029eae
Associating Elastic IP with Public Instance...
{
    "AssociationId": "eipassoc-045851eff8a8e6802"
}
Creating Private EC2 Instance...
Private Instance ID: i-0c41cbe5a9dfb5b87
Waiting for private instance to be running...

==========================================
Infrastructure Created Successfully!
==========================================

VPC:
  VPC ID: vpc-0566d293bb71b1cec
  VPC CIDR: 192.168.0.0/16

Subnets:
  Public Subnet ID: subnet-0d9872addfb2de55d (192.168.0.0/24)
  Private Subnet ID: subnet-0ae8cc16328ac6687 (192.168.1.0/24)

Gateways:
  Internet Gateway ID: igw-0d86c35657eeff79e
  NAT Gateway ID: nat-0a2dc38ddb5ddd1fe

Route Tables:
  Public Route Table ID: rtb-07a4a4de1f740d030
  Private Route Table ID: rtb-0010dc33fd8cf8f56

Security Groups:
  Public Security Group ID: sg-01792dd14dfccfde9
  Private Security Group ID: sg-022b9c6678600264c

Key Pair:
  Key Pair Name: Flyon21-KeyPair

EC2 Instances:
  Public Instance ID: i-00110b7dc75a13790
  Public Instance Private IP: 192.168.0.4
  Public Instance Public IP (EIP): 3.78.145.31

  Private Instance ID: i-0c41cbe5a9dfb5b87
  Private Instance Private IP: 192.168.1.4

==========================================
Connection Instructions:
==========================================

Using YOUR existing private key: /home/flyon21/.ssh/zhoholiev
(This corresponds to the public key you provided: /home/flyon21/.ssh/zhoholiev.pub)

To connect to the public instance (bastion):
  ssh -i /home/flyon21/.ssh/zhoholiev ec2-user@3.78.145.31

To connect to the private instance (via bastion):
  ssh -i /home/flyon21/.ssh/zhoholiev -o ProxyCommand="ssh -i /home/flyon21/.ssh/zhoholiev -W %h:%p ec2-user@3.78.145.31" ec2-user@192.168.1.4

==========================================



==========================================
AWS Infrastructure Cleanup Script
==========================================
AWS Profile: flyon21
WARNING: This will delete all Flyon21 infrastructure!
==========================================
Are you sure you want to continue? (yes/no): yes

Starting cleanup...
./aws_cli_hw12_uninstall.sh: 33: [: vpc-0566d293bb71b1cec: unexpected operator
Found VPC: vpc-0566d293bb71b1cec
[1/12] Terminating EC2 Instances...
Terminating instances: i-0c41cbe5a9dfb5b87      i-00110b7dc75a13790
{
    "TerminatingInstances": [
        {
            "InstanceId": "i-00110b7dc75a13790",
            "CurrentState": {
                "Code": 32,
                "Name": "shutting-down"
            },
            "PreviousState": {
                "Code": 16,
                "Name": "running"
            }
        },
        {
            "InstanceId": "i-0c41cbe5a9dfb5b87",
            "CurrentState": {
                "Code": 32,
                "Name": "shutting-down"
            },
            "PreviousState": {
                "Code": 16,
                "Name": "running"
            }
        }
    ]
}
Waiting for instances to terminate...
Instances terminated.
[2/12] Releasing Elastic IPs...
Releasing EIP: eipalloc-089cb23b69c7a09fc
Releasing EIP: eipalloc-05ed41c5757029eae
Releasing EIP: eipalloc-0fcdc8afa37250510

An error occurred (AuthFailure) when calling the ReleaseAddress operation: You do not have permission to access the specified resource.
Failed to release eipalloc-0fcdc8afa37250510 (may already be released)
[3/12] Deleting NAT Gateways...
Deleting NAT Gateway: nat-0a2dc38ddb5ddd1fe
{
    "NatGatewayId": "nat-0a2dc38ddb5ddd1fe"
}
Waiting for NAT Gateways to be deleted...
[4/12] Deleting Route Table Associations...
Disassociating route table association: rtbassoc-09cc0f3244ffa08b3
Disassociating route table association: rtbassoc-0ebefb048e886b5eb
[5/12] Detaching and Deleting Internet Gateway...
Detaching Internet Gateway: igw-0d86c35657eeff79e
Deleting Internet Gateway: igw-0d86c35657eeff79e
[6/12] Deleting Route Tables...
Deleting Route Table: rtb-0010dc33fd8cf8f56
Deleting Route Table: rtb-07a4a4de1f740d030
[7/12] Deleting Security Groups...
Deleting Security Group: sg-022b9c6678600264c
{
    "Return": true,
    "GroupId": "sg-022b9c6678600264c"
}
Deleting Security Group: sg-01792dd14dfccfde9
{
    "Return": true,
    "GroupId": "sg-01792dd14dfccfde9"
}
Security group sg-022b9c6678600264c already deleted or still has dependencies
Security group sg-01792dd14dfccfde9 already deleted or still has dependencies
[8/12] Deleting Subnets...
Deleting Subnet: subnet-0d9872addfb2de55d
Deleting Subnet: subnet-0ae8cc16328ac6687
[9/12] Deleting VPC...
VPC deleted: vpc-0566d293bb71b1cec
[10/12] Deleting Key Pair...
{
    "Return": true,
    "KeyPairId": "key-0cd129466e43ee876"
}
Key pair deleted: Flyon21-KeyPair
[11/12] Cleaning up local key file...
No local key file found.
[12/12] Cleanup complete!

==========================================
All Flyon21 infrastructure has been deleted.
==========================================